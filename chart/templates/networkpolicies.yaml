---
# 1️⃣ Permitir que FRONTEND se comunique con BACKEND-API
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-frontend-to-backend-api
  namespace: lpintofsgrp-dev
spec:
  podSelector:
    matchLabels:
      app: backend-api
  policyTypes:
    - Ingress
  ingress:
    - from:
        - podSelector:
            matchLabels:
              app: frontend
      ports:
        - protocol: TCP
          port: 8080

---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-frontend-egress
  namespace: lpintofsgrp-dev
spec:
  podSelector:
    matchLabels:
      app: frontend
  policyTypes:
    - Egress
  egress:
    - to:
        - podSelector:
            matchLabels:
              app: backend-api
      ports:
        - protocol: TCP
          port: 8080

---
# 2️⃣ Permitir que BACKEND-API se comunique con BACKEND-DATA
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-backend-api-to-backend-data
  namespace: lpintofsgrp-dev
spec:
  podSelector:
    matchLabels:
      app: backend-data
  policyTypes:
    - Ingress
  ingress:
    - from:
        - podSelector:
            matchLabels:
              app: backend-api
      ports:
        - protocol: TCP
          port: 8081

---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-backend-api-egress
  namespace: lpintofsgrp-dev
spec:
  podSelector:
    matchLabels:
      app: backend-api
  policyTypes:
    - Egress
  egress:
    - to:
        - podSelector:
            matchLabels:
              app: backend-data
      ports:
        - protocol: TCP
          port: 8081

---
# 3️⃣ Permitir que BACKEND-DATA se comunique con POSTGRES
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-backend-data-to-postgres
  namespace: lpintofsgrp-dev
spec:
  podSelector:
    matchLabels:
      app: postgres
  policyTypes:
    - Ingress
  ingress:
    - from:
        - podSelector:
            matchLabels:
              app: backend-data
      ports:
        - protocol: TCP
          port: 5432

---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-backend-data-egress
  namespace: lpintofsgrp-dev
spec:
  podSelector:
    matchLabels:
      app: backend-data
  policyTypes:
    - Egress
  egress:
    - to:
        - podSelector:
            matchLabels:
              app: postgres
      ports:
        - protocol: TCP
          port: 5432

---
# 4️⃣ Permitir que pods de prueba (como curlpod) puedan salir a cualquier lugar
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-egress-test-tools
  namespace: lpintofsgrp-dev
spec:
  podSelector:
    matchLabels:
      run: curlpod
  policyTypes:
    - Egress
  egress:
    - to:
        - namespaceSelector: {}

---
# 5️⃣ Permitir que pods de prueba puedan ingresar a otros pods del namespace
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-ingress-to-test-tools
  namespace: lpintofsgrp-dev
spec:
  podSelector: {}  # aplica a todos los pods destino
  policyTypes:
    - Ingress
  ingress:
    - from:
        - podSelector:
            matchLabels:
              run: curlpod
