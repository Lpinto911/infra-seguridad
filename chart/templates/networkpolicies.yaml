---
# 1️⃣ Permitir que los pods de prueba (curlpod) puedan hacer pruebas de red
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-egress-test-tools
  namespace: lpintofsgrp-dev
spec:
  podSelector:
    matchLabels:
      run: curlpod
  policyTypes:
    - Egress
  egress:
    - to:
        - namespaceSelector: {} # permite salir a cualquier namespace
      ports:
        - protocol: TCP
          port: 80
        - protocol: TCP
          port: 8080
        - protocol: TCP
          port: 8081
        - protocol: TCP
          port: 5432

---
# 2️⃣ Permitir que los pods curlpod puedan ser accedidos para pruebas
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-ingress-to-test-tools
  namespace: lpintofsgrp-dev
spec:
  podSelector: {}
  policyTypes:
    - Ingress
  ingress:
    - from:
        - podSelector:
            matchLabels:
              run: curlpod

---
# 3️⃣ Permitir que el FRONTEND se comunique con el BACKEND-API
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-frontend-to-backend-api
  namespace: lpintofsgrp-dev
spec:
  podSelector:
    matchLabels:
      app: backend-api
  policyTypes:
    - Ingress
  ingress:
    - from:
        - podSelector:
            matchLabels:
              app: frontend
      ports:
        - protocol: TCP
          port: 8080

---
# 4️⃣ Permitir que el BACKEND-API se comunique con el BACKEND-DATA
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-backend-api-to-backend-data
  namespace: lpintofsgrp-dev
spec:
  podSelector:
    matchLabels:
      app: backend-data
  policyTypes:
    - Ingress
  ingress:
    - from:
        - podSelector:
            matchLabels:
              app: backend-api
      ports:
        - protocol: TCP
          port: 8081

---
# 5️⃣ Permitir que el BACKEND-DATA se comunique con POSTGRES
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-backend-data-to-postgres
  namespace: lpintofsgrp-dev
spec:
  podSelector:
    matchLabels:
      app: postgres
  policyTypes:
    - Ingress
  ingress:
    - from:
        - podSelector:
            matchLabels:
              app: backend-data
      ports:
        - protocol: TCP
          port: 5432
